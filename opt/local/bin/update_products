#!/usr/bin/env bash

trap_ctrlc() {
    echo "Ctrl-C caught...exiting script."
    exit 130
}

trap "trap_ctrlc" 2

source "$DATACUBE_ENV"
echo "Updating products..."

asset='ECMWF/ERA5/DAILY'
product='era5_daily_google'
parser='era5'
echo "Updating $product"
index_gee --asset $asset --product $product --parser $parser --rolling_update 

asset='LANDSAT/LE07/C01/T1_SR'
product='ls7_google'
parser='ls7'
regions=()
regions+=(
el_salvador
ghana
nsw
)
for region in "${regions[@]}"; do
    echo "Updating $product"_"$region"
    index_gee --asset $asset --product $product\_$region --parser $parser \
        --region $region --rolling_update
done

asset='LANDSAT/LC08/C01/T1_SR'
product='ls8_google'
parser='ls8'
regions=()
regions+=(
el_salvador
ghana
nsw
tanzania
vanuatu
)
for region in "${regions[@]}"; do
    echo "Updating $product"_"$region"
    index_gee --asset $asset --product $product\_$region --parser $parser \
        --region $region --rolling_update 
done

#asset='JAXA/ALOS/PALSAR/YEARLY/SAR'
#product='palsar_yearly_google'
#parser='alos'
#index_gee --asset $asset --product $product --parser $parser --rolling_update 

asset='COPERNICUS/S1_GRD'
product='s1_google'
parser='s1'
regions=()
regions+=(
el_salvador
ghana
nsw
tanzania
vanuatu
)
for region in "${regions[@]}"; do
    echo "Updating $product"_"$region"
    index_gee --asset $asset --product $product\_$region --parser $parser \
        --region $region --rolling_update 
done

asset='COPERNICUS/S2_SR'
product='s2_google'
parser='s2'
regions=()
regions+=(
el_salvador
ghana
nsw
tanzania
vanuatu
)
for region in "${regions[@]}"; do
    echo "Updating $product"_"$region"
    index_gee --asset $asset --product $product\_$region --parser $parser \
        --region $region --rolling_update 
done

echo "Finished update."
deactivate

exit 0
