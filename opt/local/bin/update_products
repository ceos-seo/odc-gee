#!/usr/bin/env bash

trap_ctrlc() {
    echo "Ctrl-C caught...exiting script."
    exit 130
}

trap "trap_ctrlc" 2

source "$DATACUBE_ENV"
echo "Updating products..."

asset='ECMWF/ERA5/DAILY'
product='era5_daily_google'

echo "Updating $product"
index_gee --asset $asset --product $product --rolling_update

regions=()
regions+=(
el_salvador
ghana
nsw
)

asset='LANDSAT/LE07/C01/T1_SR'
product='ls7_google'
for region in "${regions[@]}"; do
    echo "Updating $product"_"$region"
    index_gee --asset $asset --product $product\_$region \
        --region $region --rolling_update
done

regions+=(
tanzania
vanuatu
)

asset='LANDSAT/LC08/C01/T1_SR'
product='ls8_google'
for region in "${regions[@]}"; do
    echo "Updating $product"_"$region"
    index_gee --asset $asset --product $product\_$region \
        --region $region --rolling_update
done

asset='COPERNICUS/S1_GRD'
product='s1_google'
for region in "${regions[@]}"; do
    echo "Updating $product"_"$region"
    index_gee --asset $asset --product $product\_$region \
        --region $region --rolling_update
done

asset='COPERNICUS/S2_SR'
product='s2_google'
for region in "${regions[@]}"; do
    echo "Updating $product"_"$region"
    index_gee --asset $asset --product $product\_$region \
        --region $region --rolling_update
done

echo "Finished update."
deactivate

exit 0
